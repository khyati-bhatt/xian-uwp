<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server-Hosted DApp ‚Üí Local Wallet Demo</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåê Server-Hosted DApp Demo</h1>
            <h2>Connecting to Local Xian Wallet</h2>
            <p>This demonstrates a <strong>real-world scenario</strong> where your DApp is hosted on a server (like Vercel, Netlify, or your domain) but connects to the user's <strong>local wallet</strong>.</p>
            
            <div class="scenario-info">
                <div class="scenario-item">
                    <span class="icon">üåç</span>
                    <div>
                        <strong>DApp Location:</strong><br>
                        <code id="dappOrigin">Loading...</code>
                    </div>
                </div>
                <div class="scenario-item">
                    <span class="icon">üíª</span>
                    <div>
                        <strong>Wallet Location:</strong><br>
                        <code>http://localhost:8545</code> (User's computer)
                    </div>
                </div>
            </div>
        </header>

        <!-- CORS Status -->
        <section class="cors-status">
            <div class="status-card">
                <h3>üîí CORS Connection Status</h3>
                <div id="corsStatus" class="status-indicator">
                    <div class="spinner"></div>
                    <span>Testing connection...</span>
                </div>
                <div id="corsDetails" class="cors-details"></div>
            </div>
        </section>

        <!-- Wallet Setup Instructions -->
        <section class="setup-instructions">
            <div class="instructions-card">
                <h3>üìã Setup Instructions</h3>
                <div class="step-list">
                    <div class="step">
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <strong>Start Local Wallet with CORS</strong>
                            <div class="code-block">
                                <code>python -c "from xian_uwp import create_server, CORSConfig; server = create_server(cors_config=CORSConfig.production(['<span id="currentOrigin">your-domain.com</span>'])); server.run(host='0.0.0.0', port=8545)"</code>
                                <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
                            </div>
                            <p class="step-note">‚ö†Ô∏è <strong>Important:</strong> Use <code>host='0.0.0.0'</code> to allow external connections and configure your specific domain in the CORS origins.</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <strong>Configure Firewall (if needed)</strong>
                            <p>Ensure port 8545 is accessible from your network. For local testing, this usually works automatically.</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">3</span>
                        <div class="step-content">
                            <strong>Connect DApp</strong>
                            <p>Click "Connect to Local Wallet" below once your wallet is running.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Connection Controls -->
        <section class="connection-section">
            <div class="connection-card">
                <div class="connection-status">
                    <div id="connectionIndicator" class="status-dot disconnected"></div>
                    <span id="connectionText">Not Connected</span>
                </div>
                <div class="connection-controls">
                    <button id="connectBtn" class="btn btn-primary">Connect to Local Wallet</button>
                    <button id="disconnectBtn" class="btn btn-secondary" style="display: none;">Disconnect</button>
                </div>
            </div>
        </section>

        <!-- Wallet Information -->
        <section class="wallet-info" style="display: none;">
            <div class="info-card">
                <h3>üí≥ Wallet Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <label>Address:</label>
                        <span id="walletAddress" class="mono">-</span>
                    </div>
                    <div class="info-item">
                        <label>Balance:</label>
                        <span id="walletBalance">-</span>
                    </div>
                    <div class="info-item">
                        <label>Network:</label>
                        <span id="walletNetwork">-</span>
                    </div>
                    <div class="info-item">
                        <label>Wallet Type:</label>
                        <span id="walletType">-</span>
                    </div>
                </div>
                <button id="refreshBtn" class="btn btn-outline">Refresh Info</button>
            </div>
        </section>



        <!-- Results Log -->
        <section class="results-section">
            <div class="results-card">
                <h3>üìä Activity Log</h3>
                <div id="resultsLog" class="results-log">
                    <div class="log-entry info">
                        <span class="timestamp">Ready</span>
                        <span class="message">DApp loaded and ready to connect to local wallet</span>
                    </div>
                </div>
                <button id="clearLogBtn" class="btn btn-outline btn-small">Clear Log</button>
            </div>
        </section>

        <!-- Technical Details -->
        <section class="technical-details">
            <div class="details-card">
                <h3>üîß Technical Details</h3>
                <div class="tech-grid">
                    <div class="tech-item">
                        <strong>Architecture:</strong>
                        <p>Server-hosted DApp ‚Üí CORS ‚Üí Local Wallet</p>
                    </div>
                    <div class="tech-item">
                        <strong>Security:</strong>
                        <p>CORS-protected, session-based authentication</p>
                    </div>
                    <div class="tech-item">
                        <strong>Compatibility:</strong>
                        <p>Works with any web hosting (Vercel, Netlify, AWS, etc.)</p>
                    </div>
                    <div class="tech-item">
                        <strong>Wallet Types:</strong>
                        <p>Desktop, CLI, Web wallets supported</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="xian-wallet-client.js"></script>
    <script src="server-hosted-app.js"></script>
</body>
</html>